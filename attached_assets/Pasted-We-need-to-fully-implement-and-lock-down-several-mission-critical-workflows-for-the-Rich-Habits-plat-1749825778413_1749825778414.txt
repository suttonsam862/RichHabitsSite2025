We need to fully implement and lock down several mission-critical workflows for the Rich Habits platform. Do not proceed until each point is covered thoroughly. Do not introduce fallback logic. All fixes must be airtight, verified, and logged.

---

### ğŸ”’ PART 1 â€” FIX STRIPE PAYMENT SYSTEM FOR EVENT SIGNUPS

1. âœ… Remove all mock/fallback event mappings (e.g., `|| 1`, `eventSlugToIdMap`)
2. âœ… In `stripe.ts` and `routes.ts`:
   - Look up the event using the actual `eventId` UUID from the frontend form
   - If invalid or not found, fail the request and log the error
3. âœ… Stripe `PaymentIntent` metadata must include:
   - `eventId`, `eventName`, and all form fields (name, grade, shirt size, school, etc.)
4. âœ… Stripe webhook should:
   - Validate metadata against real database events
   - Reject or ignore any `payment_intent.succeeded` with unknown or missing event ID
5. âœ… After validation, successful payments should:
   - Create a registration record
   - Trigger `createShopifyOrderFromRegistration(...)`
   - Save `shopifyOrderId` and `stripePaymentIntentId` into the registration row

---

### ğŸ›ï¸ PART 2 â€” BUILD FULL VARIANT IMAGE-TO-COLOR UX ON PRODUCT PAGES

1. âœ… On `/shop/:handle` product pages:
   - Selecting a color should update the main product image
   - Use `variant.image.url` from the Shopify Storefront API to link color to image
2. âœ… Add variant selector UI (dropdown or swatches)
3. âœ… Selecting a variant should also update:
   - Price
   - Availability
   - Shopify variant ID stored for Add to Cart
4. âœ… Do not break routing â€” all `/shop/:handle` pages must load fully

---

### ğŸ›’ PART 3 â€” COMPLETE SHOPIFY-BACKED RETAIL CART

1. âœ… Only show â€œAdd to Cartâ€ on **retail** product pages (not events)
2. âœ… Add to Cart stores:
   - Shopify product ID
   - Shopify variant ID
   - Quantity
   - Title, price, image
3. âœ… Build `/cart` route UI:
   - Users can view all added items
   - Remove/edit quantity
   - Click â€œCheckoutâ€ to start Shopify checkout
4. âœ… At checkout, send the correct variant IDs and quantities to Shopify to initiate session

---

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ PART 4 â€” SIMPLIFY TEAM REGISTRATION

1. âœ… Remove parentName, parentPhone, and any guardian fields from team registration form
2. âœ… Only collect:
   - Coach name + email (team contact)
   - Athlete first + last name
3. âœ… Backend schema must not reject athlete rows missing parent info

--
